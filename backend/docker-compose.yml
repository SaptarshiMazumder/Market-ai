services:
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_DB: training
      POSTGRES_USER: training
      POSTGRES_PASSWORD: training
    ports:
      - "5433:5432"
    volumes:
      - postgres-data:/var/lib/postgresql/data
    restart: unless-stopped

  pgadmin:
    image: dpage/pgadmin4
    environment:
      PGADMIN_DEFAULT_EMAIL: admin@admin.com
      PGADMIN_DEFAULT_PASSWORD: admin
    ports:
      - "5050:80"
    depends_on:
      - postgres
    restart: unless-stopped

  training:
    build: ./training
    ports:
      - "5001:5001"
    env_file:
      - ./training/.env
    environment:
      - PGHOST=postgres
      - PGPORT=5432
      - PGDATABASE=training
      - PGUSER=training
      - PGPASSWORD=training
    volumes:
      - training-uploads:/app/uploads
    depends_on:
      - postgres
    restart: unless-stopped

  image-generation:
    build: ./image-generation
    ports:
      - "5002:5002"
    env_file:
      - ./image-generation/.env
    environment:
      - PGHOST=postgres
      - PGPORT=5432
      - PGDATABASE=training
      - PGUSER=training
      - PGPASSWORD=training
    volumes:
      - generation-uploads:/app/uploads
      - generation-output:/app/generated
    depends_on:
      - postgres
    restart: unless-stopped

  templates:
    build: ./templates
    ports:
      - "5003:5003"
    env_file:
      - ./templates/.env
    environment:
      - PGHOST=postgres
      - PGPORT=5432
      - PGDATABASE=training
      - PGUSER=training
      - PGPASSWORD=training
    volumes:
      - templates-images:/app/template_images
    depends_on:
      - postgres
    restart: unless-stopped

  masking:
    build: ./masking
    ports:
      - "5004:5004"
    env_file:
      - ./masking/.env
    environment:
      - PGHOST=postgres
      - PGPORT=5432
      - PGDATABASE=training
      - PGUSER=training
      - PGPASSWORD=training
    volumes:
      - masking-output:/app/masks
    depends_on:
      - postgres
    restart: unless-stopped

  inpainting:
    build: ./inpainting
    ports:
      - "5005:5005"
    env_file:
      - ./inpainting/.env
    environment:
      - PGHOST=postgres
      - PGPORT=5432
      - PGDATABASE=training
      - PGUSER=training
      - PGPASSWORD=training
    volumes:
      - inpainting-output:/app/inpainted
    depends_on:
      - postgres
    restart: unless-stopped

  video-generation:
    build: ./video-generation
    ports:
      - "5006:5006"
    env_file:
      - ./video-generation/.env
    environment:
      - PGHOST=postgres
      - PGPORT=5432
      - PGDATABASE=training
      - PGUSER=training
      - PGPASSWORD=training
    volumes:
      - video-output:/app/videos
    depends_on:
      - postgres
    restart: unless-stopped

volumes:
  postgres-data:
  training-uploads:
  generation-uploads:
  generation-output:
  templates-images:
  masking-output:
  inpainting-output:
  video-output:
