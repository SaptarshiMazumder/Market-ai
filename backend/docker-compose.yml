services:
  training:
    build: ./training
    ports:
      - "5001:5001"
    env_file:
      - ./training/.env
    environment:
      - GOOGLE_APPLICATION_CREDENTIALS=/gcp/adc.json
    volumes:
      - training-uploads:/app/uploads
      - ${APPDATA}/gcloud/application_default_credentials.json:/gcp/adc.json:ro
    restart: unless-stopped

  image-generation:
    build: ./image-generation
    ports:
      - "5002:5002"
    env_file:
      - ./image-generation/.env
    volumes:
      - generation-uploads:/app/uploads
      - generation-output:/app/generated
    restart: unless-stopped

  templates:
    build: ./templates
    ports:
      - "5003:5003"
    env_file:
      - ./templates/.env
    volumes:
      - templates-images:/app/template_images
      - templates-db:/app
    restart: unless-stopped

volumes:
  training-uploads:
  generation-uploads:
  generation-output:
  templates-images:
  templates-db:
